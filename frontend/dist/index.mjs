import t from"rails-ujs";import{DirectUpload as e}from"@rails/activestorage";import r from"kitsu";import o from"mustache";import i from"turbolinks";import a from"dragula";import{Controller as n}from"stimulus";var s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toggleMoreFilters=function(t){t.preventDefault(),this.moreFiltersTarget.classList.toggle("d-none")},e.prototype.submitForm=function(t){"Enter"==t.key&&this.element.submit()},e}(n);s.targets=["toggleBtn","moreFilters"];var d=require("@uppy/core"),c=(require("@uppy/xhr-upload"),require("@uppy/dashboard")),u=require("uppy-activestorage-upload"),p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialize=function(){var t=this,e=d().use(c,{trigger:this.triggerTarget,target:this.modalTarget});e.use(u,{directUploadUrl:this.data.get("upload-url")}),e.on("complete",function(e){setTimeout(function(){window.location.replace(t.data.get("media-library-path"))},1e3)})},e}(n);function l(t,e){var r=Object.keys(t).map(function(r){var o=t[r];return t.constructor===Array?r=e+"[]":t.constructor===Object&&(r=e?e+"["+r+"]":r),"object"==typeof o?l(o,r):r+"="+encodeURIComponent(o)});return[].concat.apply([],r).join("&")}p.targets=["trigger","modal"];var g=function(e,r){try{return Promise.resolve(t.ajax({type:"PUT",url:"/admin/reorder/"+e+".json",data:l({ids:r},"")}))}catch(t){return Promise.reject(t)}},f=function(e,r){void 0===r&&(r={});try{return Promise.resolve(t.ajax(Object.assign({type:"GET",url:"/api/v1/media/"+e},r)))}catch(t){return Promise.reject(t)}},h=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={direction:{configurable:!0},model:{configurable:!0},draggableIds:{configurable:!0}};return e.prototype.connect=function(){var t=this;this.drake=a({containers:[this.containerTarget],direction:this.direction,mirrorContainer:this.containerTarget,moves:function(t,e,r){return"sortable.handle"==r.dataset.target}}),this.drake.on("drop",function(){return t.onDrop()})},e.prototype.onDrop=function(){var t=this;setTimeout(function(){g(t.model,t.draggableIds)},300)},r.direction.get=function(){return this.data.get("direction")||"vertical"},r.model.get=function(){return this.data.get("model")},r.draggableIds.get=function(){return this.draggableTargets.map(function(t){return t.dataset.id})},Object.defineProperties(e.prototype,r),e}(n);h.targets=["container","draggable"];var m=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var o={isEmpty:{configurable:!0},isUploading:{configurable:!0},isUploaded:{configurable:!0},uploadedImageUrl:{configurable:!0},uploadUrl:{configurable:!0},isAttached:{configurable:!0}};return r.prototype.connect=function(){this.isAttached&&(this.isEmpty=!1,this.isUploaded=!0)},r.prototype.upload=function(){var t=this;Array.from(this.inputTarget.files).forEach(function(e){return t.doUpload(e)}),this.inputTarget.value=null},r.prototype.doUpload=function(t){var r=this;this.isEmpty=!1,this.isUploading=!0,new e(t,this.uploadUrl).create(function(t,e){if(t)alert("Something went wrong");else{var o=document.createElement("input"),i=r;o.setAttribute("type","hidden"),o.setAttribute("value",e.signed_id),o.name=r.inputTarget.name,r.element.appendChild(o);f(e.id,{success:function(t){i.uploadedImageUrl=t.data.attributes.sizes.original}});r.isUploading=!1,r.isUploaded=!0}})},o.isEmpty.set=function(t){this._isEmpty=t,t?this.inputContainerTarget.classList.remove("d-none"):this.inputContainerTarget.classList.add("d-none")},o.isUploading.set=function(t){this._isUploading=t,t?this.progressTarget.classList.remove("d-none"):this.progressTarget.classList.add("d-none")},o.isUploaded.set=function(t){this._isUploaded=t,t?this.uploadedTarget.classList.remove("d-none"):this.uploadedTarget.classList.add("d-none")},o.uploadedImageUrl.set=function(t){this.uploadedImgTarget.setAttribute("src",t)},o.isUploading.get=function(){return this._isUploading},o.isUploaded.get=function(){return this._isUploaded},o.uploadUrl.get=function(){return this.data.get("upload-url")},o.isAttached.get=function(){return"true"==this.data.get("attached")},Object.defineProperties(r.prototype,o),r}(n);m.targets=["inputContainer","input","progress","uploaded","uploadedImg"];var y=new r({baseURL:"/api/v1"}),_=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var n={mediaIds:{configurable:!0},mediaData:{configurable:!0},uploadUrl:{configurable:!0}};return r.prototype.connect=function(){this._fetchInitialMedia(),this._setupDragula()},r.prototype.upload=function(){var t=this;Array.from(this.inputTarget.files).forEach(function(e){return t._doUpload(e)}),this.inputTarget.value=null},r.prototype.removeImage=function(t){t.preventDefault();var e=Array.from(this.imagesContainerTarget.childNodes).find(function(e){return e.getAttribute("data-id")==t.currentTarget.getAttribute("data-id")});if(!e)return!1;e.remove(),this._refreshMediaIds()},r.prototype._addImageToList=function(t){void 0===t&&(t={});var e=document.createElement("div");e.innerHTML=o.render(this.imageTemplateTarget.innerHTML,t),this.imagesContainerTarget.appendChild(e.children[0])},r.prototype._renderMedia=function(){var t=this;this.imagesContainerTarget.innerHTML="",this.mediaData.forEach(function(e){t._addImageToList(e)})},r.prototype._refreshMediaIds=function(){this.mediaIds=this.mediaData.map(function(t){return parseInt(t.id)})},r.prototype._doUpload=function(t){var r=this,o=new e(t,this.uploadUrl);this._showUploadProgress(),o.create(function(t,e){(r._hideUploadProgress(),t)?alert("Something went wrong"):y.get("media/"+e.id).then(function(t){var e=r.mediaData;e.push(t.data),r.mediaData=e,r._renderMedia(),r._refreshMediaIds()})})},r.prototype._showUploadProgress=function(){i.controller.adapter.progressBar.setValue(.8),i.controller.adapter.progressBar.show()},r.prototype._hideUploadProgress=function(){i.controller.adapter.progressBar.setValue(0),i.controller.adapter.progressBar.hide()},r.prototype._fetchInitialMedia=function(){var t=this;y.get("media",{sort:"position",filter:{id:this.mediaIds.join(",")}}).then(function(e){t.mediaData=e.data,t._renderMedia()})},r.prototype._setupDragula=function(){var t=this;this.drake=a({containers:[this.imagesContainerTarget],mirrorContainer:this.imagesContainerTarget}),this.drake.on("drop",function(){setTimeout(function(){t._refreshMediaIds()},150)})},r.prototype._refreshMediaIds=function(){var t=Array.from(this.imagesContainerTarget.childNodes).map(function(t){return t.getAttribute("data-id")});this.mediaIds=t},n.mediaIds.get=function(){return JSON.parse(this.data.get("media-ids"))},n.mediaData.get=function(){return JSON.parse(this.data.get("media"))},n.uploadUrl.get=function(){return this.data.get("upload-url")},n.mediaIds.set=function(t){this.data.set("media-ids",JSON.stringify(t)),this.mediaIdsInputTarget.value=t.join(",")},n.mediaData.set=function(t){this.data.set("media",JSON.stringify(t))},Object.defineProperties(r.prototype,n),r}(n);_.targets=["input","mediaIdsInput","imagesContainer","imageTemplate"];var b=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={currentLocale:{configurable:!0},currentLocaleCode:{configurable:!0},locales:{configurable:!0}};return e.prototype.connect=function(){this.currentLocaleCode=this.currentLocaleCode},e.prototype.showSegment=function(t){this.currentLocaleCode=t.target.dataset.showSegmentLocale},e.prototype._updateSegmentsVisibility=function(){var t=this;this.segmentTargets.forEach(function(e){e.dataset.localeCode==t.currentLocale.code?e.classList.remove("d-none"):e.classList.add("d-none")})},e.prototype._findLocale=function(t){return this.locales.find(function(e){return e.code==t})},e.prototype._updateCurrentLocaleInView=function(){this.currentLocaleTarget.text=this.currentLocale.name},r.currentLocale.get=function(){return this._findLocale(this.currentLocaleCode)},r.currentLocaleCode.get=function(){return this.data.get("current-locale-code")},r.locales.get=function(){return this.switchTargets.map(function(t){return{code:t.dataset.showSegmentLocale,name:t.text}})},r.currentLocaleCode.set=function(t){this.data.set("current-locale-code",t),this._updateCurrentLocaleInView(),this._updateSegmentsVisibility()},Object.defineProperties(e.prototype,r),e}(n);b.targets=["segment","currentLocale","switch"];export{s as SearchFormController,p as MediaLibraryUploadBtnController,h as SortableController,m as ImageInputController,_ as ImagesInputController,b as LocalizedContentController};
//# sourceMappingURL=index.mjs.map

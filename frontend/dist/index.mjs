import"turbolinks";import t from"dragula";import e from"rails-ujs";import{Controller as r}from"stimulus";import{DirectUpload as o}from"@rails/activestorage";var i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toggleMoreFilters=function(t){t.preventDefault(),this.moreFiltersTarget.classList.toggle("d-none")},e.prototype.submitForm=function(t){"Enter"==t.key&&this.element.submit()},e}(r);i.targets=["toggleBtn","moreFilters"];var n=require("@uppy/core"),a=(require("@uppy/xhr-upload"),require("@uppy/dashboard")),s=require("uppy-activestorage-upload"),u=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialize=function(){var t=this,e=n().use(a,{trigger:this.triggerTarget,target:this.modalTarget});e.use(s,{directUploadUrl:this.data.get("upload-url")}),e.on("complete",function(e){setTimeout(function(){window.location.replace(t.data.get("media-library-path"))},1e3)})},e}(r);function p(t,e){var r=Object.keys(t).map(function(r){var o=t[r];return t.constructor===Array?r=e+"[]":t.constructor===Object&&(r=e?e+"["+r+"]":r),"object"==typeof o?p(o,r):r+"="+encodeURIComponent(o)});return[].concat.apply([],r).join("&")}u.targets=["trigger","modal"];var d=function(t,r){try{return Promise.resolve(e.ajax({type:"PUT",url:"/admin/reorder/"+t+".json",data:p({ids:r},"")}))}catch(t){return Promise.reject(t)}},c=function(t,r){void 0===r&&(r={});try{return Promise.resolve(e.ajax(Object.assign({type:"GET",url:"/api/v1/media/"+t},r)))}catch(t){return Promise.reject(t)}},l=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var o={direction:{configurable:!0},model:{configurable:!0},draggableIds:{configurable:!0}};return r.prototype.connect=function(){var e=this;this.drake=t({containers:[this.containerTarget],direction:this.direction,mirrorContainer:this.containerTarget,moves:function(t,e,r){return"sortable.handle"==r.dataset.target}}),this.drake.on("drop",function(){return e.onDrop()})},r.prototype.onDrop=function(){var t=this;setTimeout(function(){d(t.model,t.draggableIds)},300)},o.direction.get=function(){return this.data.get("direction")||"vertical"},o.model.get=function(){return this.data.get("model")},o.draggableIds.get=function(){return this.draggableTargets.map(function(t){return t.dataset.id})},Object.defineProperties(r.prototype,o),r}(r);l.targets=["container","draggable"];var g=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={isEmpty:{configurable:!0},isUploading:{configurable:!0},isUploaded:{configurable:!0},uploadedImageUrl:{configurable:!0},uploadUrl:{configurable:!0},isAttached:{configurable:!0}};return e.prototype.connect=function(){this.isAttached&&(this.isEmpty=!1,this.isUploaded=!0)},e.prototype.upload=function(){var t=this;Array.from(this.inputTarget.files).forEach(function(e){return t.doUpload(e)}),this.inputTarget.value=null},e.prototype.doUpload=function(t){var e=this;this.isEmpty=!1,this.isUploading=!0,new o(t,this.uploadUrl).create(function(t,r){if(t)alert("Something went wrong");else{var o=document.createElement("input"),i=e;o.setAttribute("type","hidden"),o.setAttribute("value",r.signed_id),o.name=e.inputTarget.name,e.element.appendChild(o);c(r.id,{success:function(t){i.uploadedImageUrl=t.data.attributes.sizes.original}});e.isUploading=!1,e.isUploaded=!0}})},r.isEmpty.set=function(t){this._isEmpty=t,t?this.inputTarget.classList.remove("d-none"):this.inputTarget.classList.add("d-none")},r.isUploading.set=function(t){this._isUploading=t,t?this.progressTarget.classList.remove("d-none"):this.progressTarget.classList.add("d-none")},r.isUploaded.set=function(t){this._isUploaded=t,t?this.uploadedTarget.classList.remove("d-none"):this.uploadedTarget.classList.add("d-none")},r.uploadedImageUrl.set=function(t){this.uploadedImgTarget.setAttribute("src",t)},r.isUploading.get=function(){return this._isUploading},r.isUploaded.get=function(){return this._isUploaded},r.uploadUrl.get=function(){return this.data.get("upload-url")},r.isAttached.get=function(){return"true"==this.data.get("attached")},Object.defineProperties(e.prototype,r),e}(r);g.targets=["input","progress","uploaded","uploadedImg"];export{i as SearchFormController,u as MediaLibraryUploadBtnController,l as SortableController,g as ImageInputController};
//# sourceMappingURL=index.mjs.map

function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var e=t(require("rails-ujs")),r=require("@rails/activestorage"),o=t(require("kitsu")),i=t(require("mustache")),n=t(require("turbolinks")),a=t(require("dragula")),s=require("stimulus"),d=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toggleMoreFilters=function(t){t.preventDefault(),this.moreFiltersTarget.classList.toggle("d-none")},e.prototype.submitForm=function(t){"Enter"==t.key&&this.element.submit()},e}(s.Controller);d.targets=["toggleBtn","moreFilters"];var u=require("@uppy/core"),c=(require("@uppy/xhr-upload"),require("@uppy/dashboard")),p=require("uppy-activestorage-upload"),l=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialize=function(){var t=this,e=u().use(c,{trigger:this.triggerTarget,target:this.modalTarget});e.use(p,{directUploadUrl:this.data.get("upload-url")}),e.on("complete",function(e){setTimeout(function(){window.location.replace(t.data.get("media-library-path"))},1e3)})},e}(s.Controller);function g(t,e){var r=Object.keys(t).map(function(r){var o=t[r];return t.constructor===Array?r=e+"[]":t.constructor===Object&&(r=e?e+"["+r+"]":r),"object"==typeof o?g(o,r):r+"="+encodeURIComponent(o)});return[].concat.apply([],r).join("&")}l.targets=["trigger","modal"];var h=function(t,r){try{return Promise.resolve(e.ajax({type:"PUT",url:"/admin/reorder/"+t+".json",data:g({ids:r},"")}))}catch(t){return Promise.reject(t)}},f=function(t,r){void 0===r&&(r={});try{return Promise.resolve(e.ajax(Object.assign({type:"GET",url:"/api/v1/media/"+t},r)))}catch(t){return Promise.reject(t)}},m=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={direction:{configurable:!0},model:{configurable:!0},draggableIds:{configurable:!0}};return e.prototype.connect=function(){var t=this;this.drake=a({containers:[this.containerTarget],direction:this.direction,mirrorContainer:this.containerTarget,moves:function(t,e,r){return"sortable.handle"==r.dataset.target}}),this.drake.on("drop",function(){return t.onDrop()})},e.prototype.onDrop=function(){var t=this;setTimeout(function(){h(t.model,t.draggableIds)},300)},r.direction.get=function(){return this.data.get("direction")||"vertical"},r.model.get=function(){return this.data.get("model")},r.draggableIds.get=function(){return this.draggableTargets.map(function(t){return t.dataset.id})},Object.defineProperties(e.prototype,r),e}(s.Controller);m.targets=["container","draggable"];var y=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var o={isEmpty:{configurable:!0},isUploading:{configurable:!0},isUploaded:{configurable:!0},uploadedImageUrl:{configurable:!0},uploadUrl:{configurable:!0},isAttached:{configurable:!0}};return e.prototype.connect=function(){this.isAttached&&(this.isEmpty=!1,this.isUploaded=!0)},e.prototype.upload=function(){var t=this;Array.from(this.inputTarget.files).forEach(function(e){return t.doUpload(e)}),this.inputTarget.value=null},e.prototype.doUpload=function(t){var e=this;this.isEmpty=!1,this.isUploading=!0,new r.DirectUpload(t,this.uploadUrl).create(function(t,r){if(t)alert("Something went wrong");else{var o=document.createElement("input"),i=e;o.setAttribute("type","hidden"),o.setAttribute("value",r.signed_id),o.name=e.inputTarget.name,e.element.appendChild(o);f(r.id,{success:function(t){i.uploadedImageUrl=t.data.attributes.sizes.original}});e.isUploading=!1,e.isUploaded=!0}})},o.isEmpty.set=function(t){this._isEmpty=t,t?this.inputContainerTarget.classList.remove("d-none"):this.inputContainerTarget.classList.add("d-none")},o.isUploading.set=function(t){this._isUploading=t,t?this.progressTarget.classList.remove("d-none"):this.progressTarget.classList.add("d-none")},o.isUploaded.set=function(t){this._isUploaded=t,t?this.uploadedTarget.classList.remove("d-none"):this.uploadedTarget.classList.add("d-none")},o.uploadedImageUrl.set=function(t){this.uploadedImgTarget.setAttribute("src",t)},o.isUploading.get=function(){return this._isUploading},o.isUploaded.get=function(){return this._isUploaded},o.uploadUrl.get=function(){return this.data.get("upload-url")},o.isAttached.get=function(){return"true"==this.data.get("attached")},Object.defineProperties(e.prototype,o),e}(s.Controller);y.targets=["inputContainer","input","progress","uploaded","uploadedImg"];var _=new o({baseURL:"/api/v1"}),b=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var o={mediaIds:{configurable:!0},mediaData:{configurable:!0},uploadUrl:{configurable:!0}};return e.prototype.connect=function(){this._fetchInitialMedia(),this._setupDragula()},e.prototype.upload=function(){var t=this;Array.from(this.inputTarget.files).forEach(function(e){return t._doUpload(e)}),this.inputTarget.value=null},e.prototype.removeImage=function(t){t.preventDefault();var e=Array.from(this.imagesContainerTarget.childNodes).find(function(e){return e.getAttribute("data-id")==t.currentTarget.getAttribute("data-id")});if(!e)return!1;e.remove(),this._refreshMediaIds()},e.prototype._addImageToList=function(t){void 0===t&&(t={});var e=document.createElement("div");e.innerHTML=i.render(this.imageTemplateTarget.innerHTML,t),this.imagesContainerTarget.appendChild(e.children[0])},e.prototype._renderMedia=function(){var t=this;this.imagesContainerTarget.innerHTML="",this.mediaData.forEach(function(e){t._addImageToList(e)})},e.prototype._refreshMediaIds=function(){this.mediaIds=this.mediaData.map(function(t){return parseInt(t.id)})},e.prototype._doUpload=function(t){var e=this,o=new r.DirectUpload(t,this.uploadUrl);this._showUploadProgress(),o.create(function(t,r){(e._hideUploadProgress(),t)?alert("Something went wrong"):_.get("media/"+r.id).then(function(t){var r=e.mediaData;r.push(t.data),e.mediaData=r,e._renderMedia(),e._refreshMediaIds()})})},e.prototype._showUploadProgress=function(){n.controller.adapter.progressBar.setValue(.8),n.controller.adapter.progressBar.show()},e.prototype._hideUploadProgress=function(){n.controller.adapter.progressBar.setValue(0),n.controller.adapter.progressBar.hide()},e.prototype._fetchInitialMedia=function(){var t=this;_.get("media",{sort:"position",filter:{id:this.mediaIds.join(",")}}).then(function(e){t.mediaData=e.data,t._renderMedia()})},e.prototype._setupDragula=function(){var t=this;this.drake=a({containers:[this.imagesContainerTarget],mirrorContainer:this.imagesContainerTarget}),this.drake.on("drop",function(){setTimeout(function(){t._refreshMediaIds()},150)})},e.prototype._refreshMediaIds=function(){var t=Array.from(this.imagesContainerTarget.childNodes).map(function(t){return t.getAttribute("data-id")});this.mediaIds=t},o.mediaIds.get=function(){return JSON.parse(this.data.get("media-ids"))},o.mediaData.get=function(){return JSON.parse(this.data.get("media"))},o.uploadUrl.get=function(){return this.data.get("upload-url")},o.mediaIds.set=function(t){this.data.set("media-ids",JSON.stringify(t)),this.mediaIdsInputTarget.value=t.join(",")},o.mediaData.set=function(t){this.data.set("media",JSON.stringify(t))},Object.defineProperties(e.prototype,o),e}(s.Controller);b.targets=["input","mediaIdsInput","imagesContainer","imageTemplate"];var v=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={currentLocale:{configurable:!0},currentLocaleCode:{configurable:!0},locales:{configurable:!0}};return e.prototype.connect=function(){this.currentLocaleCode=this.currentLocaleCode},e.prototype.showSegment=function(t){this.currentLocaleCode=t.target.dataset.showSegmentLocale},e.prototype._updateSegmentsVisibility=function(){var t=this;this.segmentTargets.forEach(function(e){e.dataset.localeCode==t.currentLocale.code?e.classList.remove("d-none"):e.classList.add("d-none")})},e.prototype._findLocale=function(t){return this.locales.find(function(e){return e.code==t})},e.prototype._updateCurrentLocaleInView=function(){this.currentLocaleTarget.text=this.currentLocale.name},r.currentLocale.get=function(){return this._findLocale(this.currentLocaleCode)},r.currentLocaleCode.get=function(){return this.data.get("current-locale-code")},r.locales.get=function(){return this.switchTargets.map(function(t){return{code:t.dataset.showSegmentLocale,name:t.text}})},r.currentLocaleCode.set=function(t){this.data.set("current-locale-code",t),this._updateCurrentLocaleInView(),this._updateSegmentsVisibility()},Object.defineProperties(e.prototype,r),e}(s.Controller);v.targets=["segment","currentLocale","switch"],exports.SearchFormController=d,exports.MediaLibraryUploadBtnController=l,exports.SortableController=m,exports.ImageInputController=y,exports.ImagesInputController=b,exports.LocalizedContentController=v;
//# sourceMappingURL=index.js.map
